




<!DOCTYPE html>
<html lang="zh">
    <style>
        @font-face {
            font-family: 'icomoon';
            src: url('/en/fonts/icomoon.eot?zb38vt');
            src: url('/en/fonts/icomoon.eot?zb38vt#iefix') format('embedded-opentype'),
                 url('/en/fonts/icomoon.ttf?zb38vt') format('truetype'),
                 url('/en/fonts/icomoon.woff?zb38vt') format('woff'),
                 url('/en/fonts/icomoon.svg?zb38vt#icomoon') format('svg');
            font-weight: normal;
            font-style: normal;
            font-display: block;
          }
    </style><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

<meta name="keywords" content="[Kubernetes, KubeSphere, Installation, Preparation, High Availability]">



<meta name="description" content="Learn how to configure high availability in case of a single control plane node failure.">

<link rel="icon" href="/en/images/favicon.ico" type="image/x-icon">

<title>Configure Kubernetes High Availability - KubeSphere Enterprise</title>
<link href="/en/css/theme.css" rel="stylesheet">
<link href="/en/css/bulma.css" rel="stylesheet">
<link href="/en/css/bulma-tooltip.min.css" rel="stylesheet">
<link href="/en/css/atom-one-light.css" rel="stylesheet" />
<link href="/en/css/magnific-popup.css" rel="stylesheet" />


<link href="/en/scss/main.min.56d66c39133dd11211ab0ba0a1e1290f5815d8e5ea2b67ca9a2fdabd2a1c2a9b.css" rel="stylesheet" integrity="sha256-VtZsORM90RIRqwugoeEpD1gV2OXqK2fKmi/avSocKps=">


<script src="/en/js/jquery-2.2.4.js"></script>
<body
        class="root   "
        style=""
        ><header>
  <nav class="navbar">
    
      <a href="/en" class="navbar-logo-wrapper">
        <img class="navbar-logo" src="/en/images/qingcloud-logo.svg" />
        <div class="navbar-split navbar-left-split">|</div>
        <div class="navbar-logo-text">KubeSphere Enterprise</div>
      </a>
    
    <div class="navbar-nav">
      
        <div
          class="navbar-nav-item navbar-nav-version ">
          
          <div class="dropdown-trigger">
            <span class="project-version">
              v4.2.0
            </span>
            
          </div>
          
        </div>
      
    </div>
    <div class="search navbar-search">
      <div class="control has-icons-left has-icons-right docs-search-input">
        <span class="icon is-left">
          <img src="/en/images/icons/magnifier_duotone.svg" />
        </span>
        <input
          class="input"
          name="q"
          type="input"
          placeholder="请输入关键字快速获取帮助"
          autocomplete="off"
        />
        <span class="icon is-right"> </span>
      </div>
      <img class="clear-search-input" src="/en/images/icons/close_duotone.svg" />
    </div>
    
      
      
        
          <a class="navbar-item-right btn primary-btn navbar-btn "
            target="_blank"
            data-url="https://docs.kubesphere.com.cn/"
            data-text="中文文档"
            href="https://docs.kubesphere.com.cn/">
            中文文档
          </a>
        
      
    
  </nav>
</header><script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>

<script id="search-result-item-template" type="text/x-js-template">
  <div class="search-result-content-item">
    <div class="search-result-content-item-title">
      <a href="${href}">${title}</a>
    </div>
    <div class="search-result-content-item-content">
      ${content}
    </div>
    <div class="search-result-content-item-ref">
      <ul class="content-breadcrumb">
      </ul>
    </div>
  </div>
</div>
</script>

<script id="search-breadcrumb-template" type="text/x-js-template">
  <li class="icon-slash_fill">
    <a href="${href}">${title}</a>
  </li>
</script>

<script id="search-result-total-template" type="text/x-js-template">
  <div class="search-result-total">
    共为您找到 ${count} 个结果
  </div>
</script>
<script id="search-result-page-template" type="text/x-js-template">
  <nav class="search-result-pagination pagination is-centered">
    <a class="pagination-previous icon-chevron_left_fill"></a>
    <a class="pagination-next icon-chevron_right_fill"></a>
    <ul class="pagination-list">
    </ul>
  </nav>
</script>
<div class="container">

  


  
    
  


<aside class="sidebar-wrapper">
  <div class="sidebar-drag"></div>
  <div class="sidebar">
    
      <div class="sidebar-title" >
        <a href="/en/v4.2.0/">
          
            KubeSphere Enterprise
        </a>
        
      </div>
      
    
    <nav class="sidebar-menu" id="sidebar-menu-scroll-container">
      
        
        <ul>
  
  
    
      
      
      
      
        
          <li
            class="sidebar-item active ">
            <a href="/en/v4.2.0/03-installation-and-upgrade/" >Installation Guide</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_up_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
        
          <li
            class="sidebar-item active ">
            <a href="/en/v4.2.0/03-installation-and-upgrade/01-preparations/" >Preparation</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_up_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/01-preparations/01-supported-k8s/">Environment Requirements</a>
          </li>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a  >Configure High Availability</a>
            
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/01-preparations/02-configure-high-availability/02-configure-k8s-high-availability/">Configure Kubernetes High Availability</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item active ">
            <a href="/en/v4.2.0/03-installation-and-upgrade/01-preparations/04-configure-external-persistent-storage/" >Configure External Persistent Storage</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_up_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/01-preparations/04-configure-external-persistent-storage/01-configure-storage-devices-on-cloud/">Configure Cloud Storage Devices</a>
          </li>
        
      
    
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/01-preparations/04-configure-external-persistent-storage/04-configure-neosan-csi/">Configure NeonSAN CSI</a>
          </li>
        
      
    
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/01-preparations/04-configure-external-persistent-storage/05-configure-nfs/">Configure NFS</a>
          </li>
        
      
    
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/01-preparations/04-configure-external-persistent-storage/07-configure-opensource-storage/">Configure Open Source Storage Systems</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/en/v4.2.0/03-installation-and-upgrade/02-install-kubesphere/" >Install KubeSphere Enterprise</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/02-install-kubesphere/01-online-install-kubernetes-and-kubesphere/">Online Installation of Kubernetes and KubeSphere Enterprise</a>
          </li>
        
      
    
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/02-install-kubesphere/03-activate-kse/">Activate KubeSphere Enterprise</a>
          </li>
        
      
    
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/02-install-kubesphere/04-configure-ks-high-availability/">Configure KubeSphere High Availability</a>
          </li>
        
      
    
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/02-install-kubesphere/05-appendix/">Appendix: Advanced Configuration of KubeSphere Core</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/en/v4.2.0/03-installation-and-upgrade/03-upgrade-kubesphere/" >Upgrade KubeSphere Enterprise</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/03-upgrade-kubesphere/03-online-upgrade-kubephere-from-4.1.x/">Online Upgrade from v4.1.x to v4.2.0</a>
          </li>
        
      
    
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/03-upgrade-kubesphere/04-upgrade-kubephere-from-v4.1/">Offline Upgrade from v4.1.x to v4.2.0</a>
          </li>
        
      
    
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/03-upgrade-kubesphere/05-appendix-ks-core/">Appendix 1: ks-core Helm Chart Upgrade Parameters</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/en/v4.2.0/03-installation-and-upgrade/04-uninstall-kubesphere/" >Uninstall KubeSphere Enterprise</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/04-uninstall-kubesphere/01-uninstall-kubesphere-only/">Uninstall KubeSphere Enterprise Only</a>
          </li>
        
      
    
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/04-uninstall-kubesphere/02-uninstall-kubernetes-and-kubesphere/">Uninstall Kubernetes and KubeSphere Enterprise</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
    
      
      
      
      
        
          <li
            class="sidebar-item collapsed ">
            <a href="/en/v4.2.0/03-installation-and-upgrade/05-add-and-delete-cluster-nodes/" >Add and Remove Cluster Nodes</a>
            
            
              
                
                  
                
              
            
              
                
                  
                
              
            
            
              <span
                class="menu-switch-icon icon-caret_down_fill">
              </span>
            
          </li>
          
          <ul>
  
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/05-add-and-delete-cluster-nodes/01-add-cluster-nodes/">Add Cluster Nodes</a>
          </li>
        
      
    
  
    
      
      
      
      
          <li class="sidebar-item">
            <a href="/en/v4.2.0/03-installation-and-upgrade/05-add-and-delete-cluster-nodes/02-delete-cluster-nodes/">Remove Cluster Nodes</a>
          </li>
        
      
    
  
</ul>
        
      
    
  
</ul>
        
      
    
  
    
  
</ul>
      
    </nav>

  </div>
</aside>
<div class="content-card-wrapper">
  <div class="content-card">
    <div class="content-wrapper"><ul class="content-breadcrumb">
      <li class="icon-slash_fill"><a href="/en/v4.2.0" data-url="/en/v4.2.0">KubeSphere Enterprise</a></li>
      <li class="icon-slash_fill"><a href="/en/v4.2.0/03-installation-and-upgrade" data-url="/en/v4.2.0/03-installation-and-upgrade">Installation Guide</a></li>
      <li class="icon-slash_fill"><a href="/en/v4.2.0/03-installation-and-upgrade/01-preparations" data-url="/en/v4.2.0/03-installation-and-upgrade/01-preparations">Preparation</a></li>
        
        <li class="icon-slash_fill"><a href="/en/v4.2.0/03-installation-and-upgrade/01-preparations/02-configure-high-availability/02-configure-k8s-high-availability/" data-url="/en/v4.2.0/03-installation-and-upgrade/01-preparations/02-configure-high-availability">Configure High Availability</a></li>
      <li class="icon-slash_fill"><a href="/en/v4.2.0/03-installation-and-upgrade/01-preparations/02-configure-high-availability/02-configure-k8s-high-availability" data-url="/en/v4.2.0/03-installation-and-upgrade/01-preparations/02-configure-high-availability/02-configure-k8s-high-availability">Configure Kubernetes High Availability</a></li></ul><div class="post-wrapper"><div class="post">
  <h1 class="post-title">
    Configure Kubernetes High Availability</h1>
  <div class="post-info">
    <div class="post-date">
      Time updated：2025-08-28 08:29:09
    </div>
    
    
    
    
    
    
      
    
    
  </div><div class="post-menu">
  <div class="post-menu-title">Page Catalog</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_local_load_balancer_configuration">Local Load Balancer Configuration</a></li>
    <li><a href="#_dedicated_load_balancer">Dedicated Load Balancer</a></li>
    <li><a href="#_generic_servers_as_load_balancers">Generic Servers as Load Balancers</a>
      <ul>
        <li><a href="#_prerequisites">Prerequisites</a></li>
        <li><a href="#_configure_high_availability">Configure High Availability</a></li>
        <li><a href="#_verify_high_availability">Verify High Availability</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div><div class="post-content">
    
      
      
<div class="paragraph">
<p>This section explains how to configure multiple control plane nodes for high availability in a production environment for the KubeSphere cluster. This ensures that the cluster services remain operational even if a single control plane node fails. If your KubeSphere cluster does not require high availability, you can skip this section.</p>
</div>
<div class="paragraph">
<p>This section explains the following methods for configuring high availability:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Local Load Balancer Configuration</strong>: You can install HAProxy on the worker nodes during the KubeSphere installation process using the KubeKey tool. HAProxy will act as a reverse proxy for the control plane nodes, and the Kubernetes components on the worker nodes will connect to the control plane nodes through HAProxy. This method requires additional health check mechanisms and may reduce efficiency compared to other methods, but can be used in scenarios without a dedicated load balancer and with a limited number of servers.</p>
</li>
<li>
<p><strong>Dedicated Load Balancer</strong>: You can use a load balancer provided by your cloud environment as a reverse proxy for the control plane nodes. This method requires deploying the KubeSphere cluster in a cloud environment that offers a dedicated load balancer.</p>
</li>
<li>
<p><strong>Generic Servers as Load Balancers</strong>: You can install Keepalived and HAProxy on Linux servers outside the cluster nodes to act as load balancers. This method requires at least two additional Linux servers.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_local_load_balancer_configuration">Local Load Balancer Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use HAProxy for high availability, you need to configure the following parameters in the installation configuration file <strong>config-sample.yaml</strong> during the installation of KubeSphere Enterprise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spec:
  controlPlaneEndpoint:
    internalLoadbalancer: haproxy
    domain: lb.kubesphere.local
    address: &#34;&#34;
    port: 6443</code></pre>
</div>
</div>
<div class="paragraph">
<p>KubeKey will automatically install HAProxy on the worker nodes and complete the high availability configuration, requiring no additional actions. For more information, please refer to <a href="/en/v4.2.0/02-install-kubesphere">Install {ks_product-en}</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dedicated_load_balancer">Dedicated Load Balancer</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To achieve high availability using a dedicated load balancer provided by your cloud environment, you need to perform the following steps within your cloud environment:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a load balancer with a minimum of two replicas in your cloud environment.</p>
</li>
<li>
<p>Configure the load balancer to listen on port 6443 of each control plane node in the KubeSphere cluster.</p>
</li>
<li>
<p>Obtain the IP address of the load balancer for future use during the installation of KubeSphere Enterprise.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For specific instructions, please refer to the user guide of your cloud environment or contact your cloud service provider.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generic_servers_as_load_balancers">Generic Servers as Load Balancers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following describes how to configure a generic server as a load balancer using Keepalived and HAProxy.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>You need to prepare two Linux servers that belong to the same private network as the cluster nodes as load balancers.</p>
</li>
<li>
<p>You need to prepare a Virtual IP address (VIP) to serve as the floating IP address for the two load balancer servers. This address should not be used by any other devices or components to avoid address conflicts.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configure_high_availability">Configure High Availability</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the server that will be used as the load balancer and execute the following command to install HAProxy and Keepalived (the example assumes Ubuntu as the operating system; please replace <strong>apt</strong> with the corresponding package manager for other operating systems):</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">apt install keepalived haproxy psmisc -y</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the following command to edit the HAProxy configuration file:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">vi /etc/haproxy/haproxy.cfg</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Add the following information to the HAProxy configuration file and save the file (replace &lt;IP address&gt; with the private IP addresses of the control plane nodes in the KubeSphere cluster):</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">global
    log /dev/log  local0 warning
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000
    user        haproxy
    group       haproxy
    daemon

   stats socket /var/lib/haproxy/stats

defaults
  log global
  option  httplog
  option  dontlognull
        timeout connect 5000
        timeout client 50000
        timeout server 50000

frontend kube-apiserver
  bind *:6443
  mode tcp
  option tcplog
  default_backend kube-apiserver

backend kube-apiserver
    mode tcp
    option tcplog
    option tcp-check
    balance roundrobin
    default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100
    server kube-apiserver-1 &lt;IP address&gt;:6443 check
    server kube-apiserver-2 &lt;IP address&gt;:6443 check
    server kube-apiserver-3 &lt;IP address&gt;:6443 check</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the following command to restart HAProxy:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">systemctl restart haproxy</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the following command to set HAProxy to run automatically on startup:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">systemctl enable haproxy</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the following command to edit the Keepalived configuration file:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">vi /etc/keepalived/keepalived.conf</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Add the following information to the Keepalived configuration file and save the file:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">global_defs {
  notification_email {
  }
  router_id LVS_DEVEL
  vrrp_skip_check_adv_addr
  vrrp_garp_interval 0
  vrrp_gna_interval 0
}

vrrp_script chk_haproxy {
  script &#34;killall -0 haproxy&#34;
  interval 2
  weight 2
}

vrrp_instance haproxy-vip {
  state BACKUP
  priority 100
  interface &lt;NIC&gt;
  virtual_router_id 60
  advert_int 1
  authentication {
    auth_type PASS
    auth_pass 1111
  }
  unicast_src_ip &lt;source IP address&gt;
  unicast_peer {
    &lt;peer IP address&gt;
  }

  virtual_ipaddress {
    &lt;floating IP address&gt;
  }

  track_script {
    chk_haproxy
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace the following parameters with actual values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 66.6667%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt;NIC&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The network interface card (NIC) of the current load balancer.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt;source IP address&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The IP address of the current load balancer.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt;peer IP address&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The IP address of the other load balancer.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>&lt;floating IP address&gt;</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The virtual IP address used as the floating IP address.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
<li>
<p>Execute the following command to restart Keepalived:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">systemctl restart keepalived</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the following command to set Keepalived to run automatically on startup:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">systemctl enable keepalived</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Repeat the above steps to install and configure HAProxy and Keepalived on the other load balancer server.</p>
</li>
<li>
<p>Record the floating IP address for future use during the installation of KubeSphere Enterprise.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_verify_high_availability">Verify High Availability</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the first load balancer server and execute the following command to check the floating IP address:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ip a s</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the system’s high availability is functioning properly, the configured floating IP address will be displayed in the command output. For example, in the following command output, <strong>inet 172.16.0.10/24 scope global secondary eth0</strong> indicates that the floating IP address is bound to the eth0 network interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 52:54:9e:27:38:c8 brd ff:ff:ff:ff:ff:ff
    inet 172.16.0.2/24 brd 172.16.0.255 scope global noprefixroute dynamic eth0
       valid_lft 73334sec preferred_lft 73334sec
    inet 172.16.0.10/24 scope global secondary eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::510e:f96:98b2:af40/64 scope link noprefixroute
       valid_lft forever preferred_lft forever</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the following command to simulate a failure on the current load balancer server:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">systemctl stop haproxy</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the following command again to check the floating IP address:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ip a s</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the system’s high availability is functioning properly, the command output will no longer display the floating IP address, as shown in the following command output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 52:54:9e:27:38:c8 brd ff:ff:ff:ff:ff:ff
    inet 172.16.0.2/24 brd 172.16.0.255 scope global noprefixroute dynamic eth0
       valid_lft 72802sec preferred_lft 72802sec
    inet6 fe80::510e:f96:98b2:af40/64 scope link noprefixroute
       valid_lft forever preferred_lft forever</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Log in to the other load balancer server and execute the following command to view the floating IP address:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ip a s</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the system’s high availability is functioning properly, the configured floating IP address will be displayed in the command output. For example, in the following command output, <strong>inet 172.16.0.10/24 scope global secondary eth0</strong> indicates that the floating IP address is bound to the eth0 network interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 52:54:9e:3f:51:ba brd ff:ff:ff:ff:ff:ff
    inet 172.16.0.3/24 brd 172.16.0.255 scope global noprefixroute dynamic eth0
       valid_lft 72690sec preferred_lft 72690sec
    inet 172.16.0.10/24 scope global secondary eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::f67c:bd4f:d6d5:1d9b/64 scope link noprefixroute
       valid_lft forever preferred_lft forever</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Execute the following command on the first load balancer server to restore the running of HAProxy:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">systemctl start haproxy</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>

    

  </div>
  <div class="post-footer">
    <div class="post-prev">
    </div>
    <div class="post-next">
    </div>
  </div>
  <div class="post-back-to-top">
    <span class="icon-up_3_fill"></span>
  </div>
</div>
<div class="post-placeholder"><div class="post-menu">
  <div class="post-menu-title">Page Catalog</div>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#_local_load_balancer_configuration">Local Load Balancer Configuration</a></li>
    <li><a href="#_dedicated_load_balancer">Dedicated Load Balancer</a></li>
    <li><a href="#_generic_servers_as_load_balancers">Generic Servers as Load Balancers</a>
      <ul>
        <li><a href="#_prerequisites">Prerequisites</a></li>
        <li><a href="#_configure_high_availability">Configure High Availability</a></li>
        <li><a href="#_verify_high_availability">Verify High Availability</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div></div>
      </div>
    </div>
  </div>
</div></div>
    </body><script src="/en/js/bootstrap.min.js"></script>
<script src="/en/js/autocomplete/jquery.autocomplete.js"></script>
<script src="/en/js/copy-to-clipboard.js"></script>
<script src="/en/js/highlight.min.js"></script>
<script src="/en/js/jquery.tmpl.min.js"></script>
<script src="/en/js/jquery.magnific-popup.min.js"></script>
<script src="/en/js/search/jquery.mark.min.js"></script>
<script>
  window.HUGO_BASEURL = "\/en";
  window.HUGO_I18N = "{\"applicable_scope\":\"Applicable scope\",\"next\":\"Next\",\"page_catalog\":\"Page Catalog\",\"path\":\"Path\",\"previous\":\"Previous\",\"search_empty\":\"No results found. Please try other keywords.\",\"search_placeholder\":\"Enter keywords for help\",\"study_section\":\"Study Section\",\"update_time\":\"Time updated\",\"view_docs\":\"View docs\"}";
</script>

<script type="text/javascript" src="/en/js/common.fabd21a53168b1eeeb5a5eea37f666342dfe616b67039ea0fe08d0c4ef5390f3423d28b9658e1d491ee6875867d02592c61c2b77975619099214156dcd3e1bc3.js" integrity="sha512-&#43;r0hpTFose7rWl7qN/ZmNC3&#43;YWtnA56g/gjQxO9TkPNCPSi5ZY4dSR7mh1hn0CWSxhwrd5dWGQmSFBVtzT4bww=="></script>


<script type="text/javascript" src="/en/js/client-search/dist/index.43039aa05afec4f5e41ea7babc881477ec1e8f36380984c0f50dca64a37ee0bc5ab775bc65efdf8a77cdfac99eee1264a69a7b4d4b009e05224cca8ed81cf039.js"  integrity="sha512-QwOaoFr&#43;xPXkHqe6vIgUd&#43;wejzY4CYTA9Q3KZKN&#43;4Lxat3W8Ze/finfN&#43;sme7hJkppp7TUsAngUiTMqO2BzwOQ=="></script>

<script>
  $(function() {
    
    hljs.highlightAll();
    
    $.each($('.post-content .imageblock img'), function () {
      $(this).attr('data-mfp-src', $(this).attr('src'));
    });
    $('.post-content').magnificPopup({
      disableOn: function () {
        if ($(window).width() < 600) {
          return false;
        }
        return true;
      },
      delegate: '.imageblock img',
      type: 'image',
      gallery: {
        enabled: true,
      },
    });
  });
</script>
</html>
